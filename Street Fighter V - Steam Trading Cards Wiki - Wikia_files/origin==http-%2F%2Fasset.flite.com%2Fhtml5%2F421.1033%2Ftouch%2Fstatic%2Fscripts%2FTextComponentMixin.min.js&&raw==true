window.TextComponentMixin={testLoaded:"isLoaded",bodyMin:null,headerMin:null,bottomEdgeAdj:0,wordInfoObjs:null,wordInfoObjsPointer:null,underOneLineTall:null,manipulationCompleteTimer:null,aSettingProcessed:null,allHTMLTags:["a","abbr","acronym","address","article","aside","b","big","blockquote","br","button","caption","center","cite","code","col","colgroup","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","em","fieldset","figcaption","figure","font","footer","h1","h2","h3","h4","h5","h6","header","hr","i","img","ins","kbd","label","li","main","mark","meter","nav","noscript","ol","p","pre","progress","q","s","samp","section","small","span","strike","strong","sub","summary","sup","table","tbody","td","tfoot","th","thead","time","tr","tt","u","ul","var","wbr"],init:function(){var e=this;e.bodyMin=e.config.getInt("body_min_size")?e.config.getInt("body_min_size")+1:0,e.bodyMin=e.bodyMin<3?3:e.bodyMin,e.headerMin=e.config.getInt("header_min_size")?e.config.getInt("header_min_size")+1:0,e.headerMin=e.headerMin<5?5:e.headerMin,e.config.getBoolean("downscale_font_size")?e.bottomEdgeAdj=e.config.getInt("bottom_edge_adj1"):e.considerEllipsis&&(e.bottomEdgeAdj=e.config.getInt("bottom_edge_adj2"));for(var t=0;t<e.allHTMLTags.length;t++)e.allHTMLTags[t]="<"+e.allHTMLTags[t];e.aSettingProcessed=e.api.util._.debounce(e.stringManipulationComplete,200)},homogenizeOriginalString:function(e){e=e.replace(/(\s+|\r\n|\n|\r|\t)/gm," "),e=e.replace(/<[br]{2}\s*\/?>/ig,"<br>"),e=e.replace(/<br>\s+<br>/g,"<br><br>");while(e.indexOf("<br><br><br>")>-1)e=e.replace("<br><br><br>","<br><br>");while(e.indexOf("<br><br> <br><br>")>-1)e=e.replace("<br><br> <br><br>","<br><br>");return e.substring(e.length-8,e.length)=="<br><br>"&&(e=e.substring(0,e.length-8)),e.substring(e.length-4,e.length)=="<br>"&&(e=e.substring(0,e.length-4)),e=e.replace(/<(\/)?p{1}\s*\/?>/ig,"<$1p>"),e=e.replace(/<(\/)?h([1-6])\s*\/?>/ig,"<$1h$2>"),e=e.replace(/\s+<(\/)?p>/g,"<$1p>"),e=e.replace(/<(\/)?p>\s+/g,"<$1p>"),e=e.replace(/<(\/)?h([1-6])>\s+/g,"<$1h$2>"),e=e.replace(/\s+<(\/)?h([1-6])>/g,"<$1h$2>"),e},makeWordInfoArray:function(){var e=this;if(!e.wordInfoObjs){var t,n=e.textDiv.html(),r=e.textDiv.html().replace(/(<([^>]+)>)/ig," "),i=r.split(" ");for(t=i.length-1;t>=0;t--)i[t]===""&&i.splice(t,1);e.wordInfoObjs=[];for(t=i.length-1;t>-1;t--){var s=i[t],o=!1;while(!o){o=!0;if(n.lastIndexOf(">")>n.lastIndexOf(s)){var u=n.substring(0,n.lastIndexOf(s)),a=u.lastIndexOf("<"),f=u.lastIndexOf(">");if(a>f)for(var l=0;l<e.allHTMLTags.length;l++){var c=e.allHTMLTags[l],h=u.substring(u.lastIndexOf("<"),u.length),p=h.substring(0,h.indexOf(" "));if(p===c){o=!1,n=u.substring(0,a);break}}}}var d=n.lastIndexOf(s);e.wordInfoObjs[t]={word:s,wordStartPoint:d,wordEndPoint:d+s.length},n=n.substring(0,n.lastIndexOf(s))}}},adjustFontSizeToFitComponent:function(){var e=this,t=.3,n=.9,r=0,i=0,s=!1,o=!1;while(e.textDivHeight-e.bottomEdgeAdj>e.rectangle.height){r%2?e.bodyFontSize>e.bodyMin+t?e.bodyFontSize-=t:s=!0:i==2&&(i=0,e.headerFontSize>e.headerMin+n?e.headerFontSize-=n:o=!0),e.render();if(s&&o)break;if(r>500)break;r++,i++}e.truncateBy==="lines"&&e.reduceByLine(),e.considerEllipsis?e.ellipsisConsideration():e.aSettingProcessed()},reduceByWord:function(){var e=this;e.makeWordInfoArray();var t=e.config.getInt("truncation_quantity"),n;if(t<e.wordInfoObjs.length)n=e.wordInfoObjs[t-1].wordEndPoint,e.sourceTxt=e.addEllipsisPostTruncation(e.textDiv.html().substring(0,n));else{var r=e.wordInfoObjs[e.wordInfoObjs.length-1];n=r.wordEndPoint,e.sourceTxt=e.textDiv.html().substring(0,n)}e.render(),e.truncComplete()},reduceByLine:function(){var e=this,t=e.config.getInt("truncation_quantity");if(t){e.makeWordInfoArray();var n=1,r=e.textDiv.html(),i=r.substring(0,e.wordInfoObjs[0].wordEndPoint),s=i;e.sourceTxt=s,e.render();var o=e.textDiv.height(),u=null;for(var a=0;a<e.wordInfoObjs.length+1;a++){if(a<e.wordInfoObjs.length-1){var f=e.wordInfoObjs[a].wordEndPoint,l=e.wordInfoObjs[a+1].wordEndPoint,c=r.substring(f,l);s+=c,e.sourceTxt=e.addEllipsisPostTruncation(s),e.render();if(e.textDiv.height()>o){if(n==t){a===0?e.sourceTxt=e.addEllipsisPostTruncation(i):e.sourceTxt=e.addEllipsisPostTruncation(u),e.render(),e.truncComplete();break}n++}}o=e.textDiv.height(),u=s}n<t&&(e.sourceTxt=e.originalSourceText,e.render(),e.truncComplete())}},reduceByParagraph:function(){var e="breakTag",t="paragraphTag",n="headerTag",r=this,i,s=[],o=r.textDiv.html();r.makeWordInfoArray();var u="<br><br>";for(var a=o.indexOf(u);a>=0;a=o.indexOf(u,a+1))s.push({point:a,endPoint:a+8,whiteSpaceSource:e});var f,l=o,c=r.textDiv.dom.getElementsByTagName("p"),h,p;if(c.length>0)for(f=c.length-1;f>-1;f--)if(c[f].innerText!==""){var d=c[f].outerHTML;h=l.lastIndexOf(d),p=h+c[f].outerHTML.length,p!=-1&&(l=l.substring(0,h),s.push({point:h,endPoint:p,whiteSpaceSource:t}))}else c[f].outerHTML=="<p></p>"&&(h=l.lastIndexOf("<p></p>"),h!=-1&&(l=l.substring(0,h),s.push({point:h,endPoint:h+7,whiteSpaceSource:t})));var v,m=[],g=[];for(f=1;f<7;f++){var y="h"+f;m[f]=r.textDiv.dom.getElementsByTagName(y),l=o;if(m[f].length>0)for(v=m[f].length-1;v>-1;v--)if(m[f][v].innerText!==""){var b=m[f][v].outerHTML,w=l.lastIndexOf(b),E=w+b.length;E!=-1&&(s.push({point:w,endPoint:E,whiteSpaceSource:n}),l=l.substring(0,w),g.push(m[f][v].outerHTML))}}s.push({point:o.length,endPoint:o.length,whiteSpaceSource:"endOfString"}),s.sort(function(e,t){return e.point-t.point});var S=[];for(f=0;f<s.length-1;f++){var x=s[f].whiteSpaceSource,T=s[f+1].whiteSpaceSource,N=s[f+1].point;if(x==n&&T==t||x==n&&T==n)for(var C=1;C<7;C++)if(o.substring(N-5,N)=="</h"+C+">"){S.push(f+1);break}}for(f=S.length-1;f>-1;f--)s.splice(S[f],1);S=[];for(f=0;f<s.length-1;f++){var k=!1,L=s[f].endPoint,A=s[f+1].point;if(L!=A){for(v=0;v<r.wordInfoObjs.length;v++)if(r.wordInfoObjs[v].wordStartPoint>=L&&r.wordInfoObjs[v].wordStartPoint<A){k=!0;break}k||S.push(f+1)}}for(f=S.length-1;f>-1;f--)s.splice(S[f],1);s[s.length-1].textSample!==undefined&&s[s.length-1].whiteSpaceSource===e&&s.pop();var O=16;for(f=s.length-2;f>-1;f--){var M=s[f].point,_=s[f+1].point;_<M+O&&s.splice(f+1,1)}s[0].point===0&&s.shift(),l=o;var D=r.config.getInt("truncation_quantity")-1;if(s[D]!==undefined){var P=s[D].point;l=l.substring(0,P);for(f=0;f<g.length;f++)i=l.substring(l.length-g[f].length,l.length),i==g[f]&&(l=l.substring(0,l.length-g[f].length));if(r.config.getInt("truncation_quantity")<s.length){for(f=1;f<r.wordInfoObjs.length;f++)if(r.wordInfoObjs[f].wordEndPoint>l.length){l=l.substring(0,r.wordInfoObjs[f-1].wordEndPoint);break}l=r.addEllipsisPostTruncation(l)}r.sourceTxt=l,r.render()}r.truncComplete()},ellipsisConsideration:function(){var e=this;e.textDivHeight-e.bottomEdgeAdj>e.rectangle.height&&(e.makeWordInfoArray(),e.wordInfoObjsPointer=e.wordInfoObjs.length-2,e.underOneLineTall=!1,e.addEllipsis()),e.aSettingProcessed()},addEllipsis:function(){var e=this,t=e.textDiv.html();if(e.textDivHeight-e.bottomEdgeAdj>e.rectangle.height&&t.charCodeAt(0)!==8230&&!e.underOneLineTall)if(e.wordInfoObjsPointer===0)e.underOneLineTall=!0,e.addEllipsis();else{var n=e.wordInfoObjs[e.wordInfoObjsPointer].wordEndPoint;t=t.substring(0,n),t+="&hellip;",e.wordInfoObjsPointer--,e.sourceTxt=t,e.render(),e.addEllipsis()}else{var r=e.textDiv.height(),i=!0,s=null;for(var o=1;o<e.wordInfoObjs.length;o++)if(e.wordInfoObjs[o].wordStartPoint>t.lastIndexOf(" ")&&e.wordInfoObjs[o]!==undefined&&e.wordInfoObjs[o+1]!==undefined){var u=e.wordInfoObjs[o].wordEndPoint,a=e.wordInfoObjs[o+1].wordEndPoint,f=e.originalHtmlPreStringManipulation.substring(u,a),l=e.textDiv.html();l=l.substring(0,e.getEllipsisLastIndex(l)),l=l+f+"&hellip;",e.sourceTxt=l,e.render();if(e.textDiv.height()>r){i?e.sourceTxt=e.improveEllipsis(t):e.sourceTxt=e.improveEllipsis(s),e.render();return}r=e.textDiv.height(),s=l,i=!1}e.sourceTxt=e.improveEllipsis(e.sourceTxt),e.render()}},addEllipsisPostTruncation:function(e){return e=this.improveEllipsis(e.trim()+"&hellip;"),e},improveEllipsis:function(e){var t=e.lastIndexOf("&hellip;");return t===-1&&(t=this.getEllipsisLastIndex(e)),e.substring(t-1,t).charCodeAt(0)===8230?e.substring(t-2,t-1).charCodeAt(0)===32?t-=2:t-=1:e.substring(t-3,t)==="..."&&(t-=3),e=e.substring(0,t)+"</strong></i></a></b></em></s></u>",e.substring(t-1,t)=="."?e+" &hellip;":e+"&hellip;"},getEllipsisLastIndex:function(e){for(var t=e.length-1;t>-1;t--)if(e.charCodeAt(t)===8230)return t},truncComplete:function(){var e=this;!e.considerEllipsis&&!e.downscaleFontSize&&e.aSettingProcessed()}};