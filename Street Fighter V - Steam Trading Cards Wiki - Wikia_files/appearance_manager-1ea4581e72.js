define(["base_appearance_manager","zeus_utils","zeus_constants"],function(t,e,o){var a=e.css,r=e.dom,i=(window,window.document,t.subclass({getInitialSettings:function(){var t=this,i=r.getUI(o.UI.TITLE_TEXT),n=r.getUI(o.UI.SCRUBBER),l=r.getUI(o.UI.TIMERAIL_PROGRESS),c=r.getUI(o.UI.TIMERAIL_BUFFER),s=r.getUI(o.UI.PLAY_ICON),g=(r.getUI(o.UI.BIG_PLAY),JSON.parse(JSON.stringify(window.CurrentVideoConfig.settings)));g.appearance||(g.appearance={});var b,p,d,u,m=r.getUI(o.UI.CONTROLBAR),y=getComputedStyle(m),f=/gradient/i.test(y.backgroundImage);if(f){var h=y.backgroundImage,w=[];if(h.indexOf("#")>-1)b=!0,w=h.substring(h.indexOf("#"),h.lastIndexOf(")"));else if(h.indexOf("rgb")>-1)b=!1,d=!0,w=h.substring(h.indexOf("rgb"),h.lastIndexOf(")")),h.indexOf("rgba")>-1&&(p=!0,d=!1);else{u=!0;for(var v,k=/,\s?(\w+)/gi;v=k.exec(h);)v.index===k.lastIndex&&k.lastIndex++,w.push(v[1])}w&&(b?w=w.split(","):p&&(w=function(e){var o=e.match(/(rgba?\([0-9,.\s]*\))/g),a=o[0];a=t._normalizeRGBA(a);var r=o[1];return r=t._normalizeRGBA(r),[a,r]}(w)),d&&(w=function(t){var e=/(rgb\(+.*\)).*(rgb\(+.*\))/gi.exec(t);return[e[1],e[2]]}(w)))}var C={colors:{background:y.backgroundColor,foreground:getComputedStyle(s).color,active:a.getStyleSheetOfClass(".bolt-highlight","color")},text:{provider:null,font:getComputedStyle(i).fontFamily,color:getComputedStyle(i).color},scrubber:{backgroundColor:getComputedStyle(n).backgroundColor,opacity:getComputedStyle(n).opacity,buffer:{backgroundColor:getComputedStyle(c).backgroundColor,opacity:getComputedStyle(c).opacity},progress:{backgroundColor:getComputedStyle(l).backgroundColor,opacity:getComputedStyle(l).opacity}},controlbar:{corner:"sharp",position:"docked",backgroundColor:{style:"gradient",primary:Array.isArray(w)?w[1]:null,secondary:Array.isArray(w)?w[0]:null},separator:{backgroundColor:{primary:a.getStyleSheetOfClass(".bolt-light-line","backgroundColor"),secondary:a.getStyleSheetOfClass(".bolt-dark-line","backgroundColor")},opacity:a.getStyleSheetOfClass(".bolt-separator","opacity")}},watermark:{position:"bottom-right",opacity:1}};g.appearance=e.mergeObject(C,g.appearance),window.CurrentVideoConfig.settings.appearance=g.appearance,View._dispatchEvent(o.UI.Event.INITIAL_APPEARANCE_SETTINGS_LOADED,{settings:g,related:window.CurrentVideoConfig.related})},updateTextColors:function(){var t=window.PlayerSettings.appearance,e=t.text.color;e&&a.inject(".bolt-custom-text-color {color:"+e+" !important; }");var o=t.text.font;if(o)if("google"===t.text.provider){var r=o.replace(/\s/,"+");a.addLink("//fonts.googleapis.com/css?family="+r,"googlefont",!1,function(){a.inject('.bolt-custom-font {font-family:"'+o+'", sans-serif !important;}')})}else a.inject(".bolt-custom-font {font-family:"+o+", sans-serif !important; }");LOG.info("Appearance manager:: update text colors",e)},updateColors:function(){function t(t,e){return/rgba/.test(t)?void 0:(t=t.replace("rgb","rgba"),t=t.replace(")",", 0."+e+")"))}var e=window.PlayerSettings.appearance,o=e.colors.background;if(o){0==o.indexOf("0x")&&(o="#"+o.substr(2));var r=t(o,5),i=t(o,8);a.inject(".bolt-background { background:"+o+"}"),document.getElementById("big-play-button")&&(a.hasClass(document.getElementById("big-play-button"),"big-play-custom")||a.addClass(document.getElementById("big-play-button"),"big-play-custom"),a.inject("#big-play-button.big-play-custom{ color:"+r+" ;fill:"+r+" ;background:"+r+";}")),a.inject(" .bolt-highlight,.bolt-hover-highlight:hover, .bolt-hover-highlight:hover .bolt-icon { color:"+o+" !important; fill: "+o+"!important;} .bolt-selected, .bolt-selected:hover .bolt-icon { color:"+o+" !important; fill: "+o+"!important;} .bolt-block-highlight { background:"+o+" !important}"),a.inject(".sharing-bubble .share-btn{ color:"+i+" !important;fill:"+i+" !important;background:"+i+"!important;}")}var n=e.colors.foreground;if(n){0==n.indexOf("0x")&&(n="#"+n.substr(2));var l=t(n,8);try{for(var c=window.Skin.getElementsByClassName("bolt-logo-default")[0],s=c.getElementsByTagName("path"),g=0;g<s.length;g++){var b=s[g];b.removeAttribute("fill")}}catch(p){}a.inject(".bolt-foreground { color:"+n+"; fill: "+n+"}"),document.getElementById("big-play-button")&&(a.hasClass(document.getElementById("big-play-button"),"big-play-custom")||a.addClass(document.getElementById("big-play-button"),"big-play-custom"),a.inject(".bolt-bigplay-layer.bolt-hover-highlight:active #big-play-button.big-play-custom{ color:"+l+" !important;fill:"+l+" !important;background:"+l+"!important;}")),a.inject(".sharing-bubble .share-btn path{ color:"+l+" !important;fill:"+l+" !important;background:"+l+"!important;}"),a.inject(".bolt-volume-container .bolt-volume-slider .bolt-handle{ background: "+n+" }"),a.inject("#playlist-container #playlist-content .playlist-item:active > div.playlist-item-title{ border-color: "+n+" !important; } ")}var d=e.colors.active;if(d){0==d.indexOf("0x")&&(d="#"+d.substr(2));var u=t(d,0),m=t(d,2),y=t(d,5),f=t(d,8);a.inject(" .bolt-highlight:active,.bolt-hover-highlight:active, .bolt-hover-highlight:active .bolt-icon { color:"+d+" !important; fill: "+d+"!important;} .bolt-selected:active, .bolt-selected:active .bolt-icon { color:"+d+" !important; fill: "+d+"!important;} .bolt-block-highlight:active { background:"+d+" !important}"),a.inject(".bolt-mute-icon.bolt-foreground{ color:"+d+" !important; fill: "+d+"!important;}"),a.inject(".bolt-scrubber .bolt-timebar .bolt-loaded{ background-color:"+m+" !important; background: "+m+"!important;}"),document.getElementById("big-play-button")&&(a.hasClass(document.getElementById("big-play-button"),"big-play-custom")||a.addClass(document.getElementById("big-play-button"),"big-play-custom"),a.inject("#big-play-button.big-play-custom:hover{ color:"+y+" !important;fill:"+y+" !important;background:"+y+"!important;width:140px;height140px;}")),a.inject(".bolt-bigplay-layer.bolt-hover-highlight:active #big-play-button.big-play-custom g{ color:"+d+" !important;fill:"+d+" !important;background:"+d+"!important; border:2px solid "+d+"}"),a.inject("#big-play-button.big-play-custom:hover{ color:"+y+" !important;fill:"+y+" !important;background:"+y+"!important;width:140px;height140px;}"),a.inject(".sharing-bubble{ color:"+f+" !important;fill:"+f+" !important;background:"+f+"!important;}"),a.inject(".sharing-bubble .share-btn:hover path{ color:"+d+" !important;fill:"+d+" !important;background:"+d+"!important;}"),a.inject(".bolt-volume-container .bolt-volume-slider .bolt-volume-slider-background { background: -webkit-linear-gradient(135deg, "+d+" 0%, "+u+" 100%); background: -moz-linear-gradient(135deg, "+d+" 0%, r"+u+" 100%);background: -ms-linear-gradient(135deg, "+d+" 0%, "+u+" 100%); background: -o-linear-gradient(135deg, "+d+" 0%, "+u+" 100%);background: linear-gradient(135deg, "+d+" 0%,"+u+" 100%);}"),a.inject(".bolt-volume-container .bolt-volume-slider .bolt-handle:active { background: "+f+" }"),a.inject(".bolt-hd-on .bolt-settings-btn .bolt-icon { color: "+d+" !important; fill: "+d+" !important; }"),a.inject("#fullscreen-bg{ color: "+d+" !important; fill: "+d+" !important; }"),a.inject(".bolt-scrubber .scrubber-handle:active{ background: "+d+"; border: 1px solid "+d+"  } "),a.inject('#playlist-btn[data-state="on"] #playlist-tri{ fill: '+d+" !important; color: "+d+" !important; } "),a.inject("#playlist-container #playlist-content .playlist-item:hover > div.playlist-item-title{ border-color: "+d+" !important; } ")}LOG.info("update colors","bg:",o,", fg:",n,", active:",d)},preview:function(t,i){var n=this;switch(console.log("window.Player appearance",window.PlayerSettings.appearance),t){case"bigButton":i?(View._prerollScreen&&View._prerollScreen.open(),a.inject(".bolt-bigplay-layer .bolt-icon{ fill: "+window.PlayerSettings.appearance.colors.active+"!important }")):View._prerollScreen&&View._prerollScreen.close();break;case"ageGate":View._enableAgeGate=i,View.enableAgeGate(i);break;case"share":PlayerSettings.share=i,i?r.showElement(o.UI.SHARING_BTN):r.hideElement(o.UI.SHARING_BTN);break;case"related":var l=i,c=function(){View._relatedVideoMenu?View._relatedVideoMenu.open():View.setRelatedVideos(l)};i?window.CurrentVideoConfig.related?e.xhr(window.CurrentVideoConfig.related,"get",null,function(t){l=JSON.parse(t),c()}):c():View._relatedVideoMenu&&(View._relatedVideoMenu.close(),window.CurrentVideoConfig.settings.bigButton&&n.preview("bigButton",!0));break;case"subtitle":i?(a.removeClass(Skin,"bolt-subtitle-disabled"),a.addClass(Skin,"bolt-subtitle-enabled")):(a.removeClass(Skin,"bolt-subtitle-enabled"),a.addClass(Skin,"bolt-subtitle-disabled"))}},update:function(t){var a=this,r=t,i=window.PlayerSettings.appearance;"undefined"!=typeof r.related?a.preview("related",r.related):r.settings?(window.PlayerSettings=e.mergeObject(window.PlayerSettings,r.settings,!0),"undefined"!=typeof r.settings.bigButton?a.preview("bigButton",r.settings.bigButton):"undefined"!=typeof r.settings.share?a.preview("share",r.settings.share):"undefined"!=typeof r.settings.minAge?a.preview("ageGate",r.settings.minAge):r.settings.watermark&&(PlayerSettings.watermark||(PlayerSettings.watermark={}),PlayerSettings.watermark=e.mergeObject(window.CurrentVideoConfig.settings.watermark,r.settings.watermark,!0),View._watermark.create())):r.appearance&&(r.appearance.colors&&(i.colors=e.mergeObject(i.colors,r.appearance.colors),a.updateColors()),r.appearance.text&&(i.text=e.mergeObject(i.text,r.appearance.text),a.updateTextColors()),r.appearance.controlbar&&(i.controlbar=e.mergeObject(i.controlbar,r.appearance.controlbar)),r.appearance.scrubber&&(i.scrubber=e.mergeObject(i.scrubber,r.appearance.scrubber)),r.appearance.watermark&&(i.watermark.position=r.appearance.watermark.position||i.watermark.position,i.watermark.opacity=r.appearance.watermark.opacity||i.watermark.opacity)),View._dispatchEvent(o.UI.Event.APPEARANCE_SETTINGS_CHANGED)}}));return i});