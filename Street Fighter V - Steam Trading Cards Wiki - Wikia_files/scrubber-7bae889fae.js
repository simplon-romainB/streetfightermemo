define(["base_scrubber","dragdealer","zeus_utils",window.addons.shifty],function(e,t,i,o){var n=window.ZeusConstants,r=window.client,l=window.View,a=i.dom,s=i.css,d=e.subclass({constructor:function(t){e.prototype.constructor.call(this,t);this._slider=null,this._updateTooltip=this._updateTooltip.bind(this),this._hideTooltip=this._hideTooltip.bind(this),this._openTween=new o,this._closeTween=new o},init:function(){e.prototype.init.call(this),this._createSlider()},_initTooltip:function(){var e=this;e._tooltip.element=document.getElementsByClassName("bolt-scrubber-tooltip")[0],e._tooltip.label=e._tooltip.element.firstElementChild,e._tooltip.element&&e._tooltip.label&&(e._tooltip.pointer=document.createElement("div"),e._tooltip.pointer.style.position="absolute",e._tooltip.pointer.style.width=0,e._tooltip.pointer.style.height=0,e._tooltip.pointer.style.borderWidth="5px",e._tooltip.pointer.style.borderStyle="solid",e._tooltip.pointer.style.borderColor=getComputedStyle(this._tooltip.element).backgroundColor+" transparent transparent",e._tooltip.element.appendChild(e._tooltip.pointer),e._interactiveEl.addEventListener("mouseenter",e._updateTooltip),e._interactiveEl.addEventListener("mousemove",e._updateTooltip),e._interactiveEl.addEventListener("mouseleave",e._hideTooltip))},_hideTooltip:function(){var e=this;e._tooltip.element&&(e._tooltip.element.style.display="none")},_createSlider:function(){var e=this,i=document.createElement("div");i.setAttribute("class","scrubber-handle"),i.addEventListener("mouseenter",e._updateTooltip),i.addEventListener("mousemove",e._updateTooltip),i.addEventListener("mouseleave",e._hideTooltip),e._container.appendChild(i),e._slider=new t(e._container,{vertical:!1,horizontal:!0,loose:!0,css3:!1,speed:.15,handleClass:"scrubber-handle",animationCallback:e._onSliderUpdate.bind(e),dragStartCallback:e._onSliderDragStart.bind(e),dragStopCallback:e._onSliderDragStop.bind(e)}),e._slider.reflow(),e._slider.disable(),PlayerSettings.bigButton===!1&&e.open()},_onSliderUpdate:function(e){var t=this;t._slider},_onSliderDragStart:function(e){var t=this;t._slider&&s.addClass(t._container,"scrubber-drag")},_onSliderDragStop:function(e){var t=this;t._slider&&(ContentPlayer.seek(t._slider.getValue()[0]*ContentPlayer.duration),s.removeClass(t._container,"scrubber-drag"))},setVideoStartTime:function(e){this.videoStartTime=e,this.invalidate()},invalidate:function(){var e=l.currentPlayer,t=this;e&&(t._pixelTimeFactor=e.duration/t._container.clientWidth,LOG.info("pixel time factor",e.duration,t._container.clientWidth,t._pixelTimeFactor)),t._slider&&(!e.isAd()&&e.duration>0?t._slider.enable():t._slider.disable()),t.resetWidths()},fixedValues:function(e){if(e){this._fixedValues=[25,50];var t=a.getUI(n.UI.TIMERAIL_BUFFER);t&&(t.style.width="50%");var i=a.getUI(n.UI.TIMERAIL_PROGRESS);i&&(i.style.width="25%")}else this._fixedValues=null},resetWidths:function(){var e=this;if(!e._fixedValues){var t=e.videoStartTime&&e._pixelTimeFactor!=1/0?e.videoStartTime/e._pixelTimeFactor*100/e._interactiveEl.clientWidth+"%":"1px";e._progressEl&&(e._progressEl.style.width=t),e._bufferEl&&(e._bufferEl.style.width=t),e.updateBuffer(),e.updateProgress()}},updateBuffer:function(){var e=l.currentPlayer,t=this;if(!t._fixedValues){var i=e.buffered*e.duration/100,o=i/t._pixelTimeFactor;t._bufferEl.style.width=100*o/t._interactiveEl.clientWidth+"%"}},updateProgress:function(){var e=l.currentPlayer,t=this;t._fixedValues||(t._progressEl.style.width=e.currentTime/t._pixelTimeFactor+"px",e.isAd()||t._slider.setValue(e.currentTime/e.duration,0,!1,!1))},open:function(){var e=this;if(!e.isOpen){e.isOpen=!0,a.showElement(e._container);var t=parseFloat(getComputedStyle(e._container).bottom);LOG.info("scrubber open",e._container,t),e._closeTween.stop(),e._openTween.tween({from:{bottom:t},to:{bottom:0},duration:500,start:function(){e.invalidate()},step:function(t){var i=e._container.style;i.bottom=parseFloat(t.bottom)+"px"}})}},close:function(){var e=this,t=r.isMobile?-50:-44;if(e.isOpen!==!1){e.isOpen=!1,LOG.info("scrubber close");var i=parseFloat(getComputedStyle(e._container).bottom);LOG.info("scrubber open",e._container,i),e._openTween.stop(),e._closeTween.tween({from:{bottom:i},to:{bottom:t},duration:500,delay:r.isMobile?1e3:0,start:function(){},step:function(t){var i=e._container.style;i.bottom=parseFloat(t.bottom)+"px"}})}}});return d});